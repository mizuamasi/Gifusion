<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gifusion v2.1</title>
  <link rel="stylesheet" href="style.css" />
  <!-- CodeMirror -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
  <!-- p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
</head>

<body>
  <div class="app-container">
    <!-- Left Panel: Editor, Params, Controls -->
    <div class="editor-panel">
      <header>
        <h1>Gifusion <span class="version">v2.1</span></h1>
      </header>

      <div class="tabs">
        <button class="tab-btn active" id="btn-mode-creator">Creator</button>
        <button class="tab-btn" id="btn-mode-player">Player</button>
        <button class="tab-btn" id="btn-mode-gallery">Gallery</button>
      </div>

      <!-- Main Panel (Creator/Player) -->
      <div class="tab-content active" id="main-panel">
        <!-- Creator Controls -->
        <div id="creator-controls" class="panel-section" style="display: flex; gap: 10px; margin-bottom: 10px;">
          <button id="btn-run-code" class="btn-accent" style="flex: 1;">Run Code</button>
          <button id="btn-save-sketch" class="btn-secondary" style="flex: 1;">Save Sketch</button>
        </div>

        <!-- Code Editor -->
        <textarea id="code-editor"></textarea>

        <!-- Dynamic Params -->
        <div class="panel-section">
          <h3>Parameters</h3>
          <div id="params-container" class="params-box">
            <!-- Generated by js/params.js -->
          </div>
        </div>
      </div>

      <!-- Gallery Panel (Hidden by default) -->
      <div class="tab-content hidden" id="gallery-panel">
        <div class="gallery-grid" id="gallery-grid">
          <!-- Populated by js/ui.js -->
        </div>
      </div>
    </div>

    <!-- Right Panel: Preview & Recording -->
    <div class="preview-panel">
      <div class="canvas-container">
        <div class="canvas-wrapper" id="canvas-wrapper">
          <div id="p5-canvas"></div>
        </div>
      </div>

      <div class="controls-area">
        <div class="playback-controls">
          <button id="btn-start" class="btn-primary btn-large">
            <span>●</span> Record (10s)
          </button>
          <button id="btn-stop" class="btn-secondary btn-large" disabled>
            <span>■</span> Stop
          </button>
          <select id="loop-config" class="loop-select"
            style="width: auto; margin-left: 10px; padding: 10px; background: #333; color: white; border: 1px solid #444; border-radius: 4px;">
            <option value="2">2s x 5 loops</option>
            <option value="5">5s x 2 loops</option>
            <option value="10">10s x 1 loop</option>
            <option value="1">1s x 10 loops</option>
          </select>
        </div>
        <div class="status-bar" id="status">Ready</div>
      </div>

      <div id="preview-area" class="hidden">
        <h3>Preview</h3>
        <video id="preview-video" controls loop></video>
        <div class="upload-actions">
          <button id="btn-upload" class="btn-accent btn-large">Upload Render</button>
          <div id="upload-result"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="js/config.js"></script>
  <script src="js/api.js"></script>
  <script src="js/capture.js"></script>
  <script src="js/params.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/app.js"></script>
</body>

</html>